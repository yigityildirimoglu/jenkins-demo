# Jenkins CI aşamaları için uv, güncel pip ve gerekli araçları içeren özel agent imajı
FROM python:3.11-slim

# 1. Sistem araçlarını (bc, git) kur (apt-get ile) - BU AYNI KALIYOR
RUN apt-get update && \
    apt-get install -y --no-install-recommends bc git && \
    rm -rf /var/lib/apt/lists/*

# 2. uv'yi pip ile kur - BU AYNI KALIYOR
RUN pip install --no-cache-dir uv

# *** YENİ ADIM: pip, setuptools ve wheel'i uv kullanarak güncelle ***
# Bu, pip-audit'in bulduğu pip açığını gidermelidir.
RUN uv pip install --system --upgrade pip setuptools wheel

# 4. Python test/lint araçlarını uv ile kur (Artık güncel pip ortamında)
# uv komutunu doğrudan kullanabiliriz, tam yola gerek yok.
RUN uv pip install --no-cache --system flake8 pytest pytest-cov

# 5. Varsayılan çalışma dizini
WORKDIR /app

# 6. Test için varsayılan komut
CMD ["uv", "--version"]